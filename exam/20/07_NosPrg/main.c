//====================================================================
//文件名称：main.c（应用工程主函数）
//框架提供：SD-Arm（sumcu.suda.edu.cn）
//版本更新：2017.08, 2020.06
//功能描述：见本工程的<01_Doc>文件夹下Readme.txt文件
//====================================================================

#define GLOBLE_VAR
#include "includes.h"      //包含总头文件

//----------------------------------------------------------------------
//声明使用到的内部函数
//main.c使用的内部函数声明处
void Test_Motor();
void main_Dly_ms(uint32_t ms);
//----------------------------------------------------------------------
//主函数，一般情况下可以认为程序从此开始运行（实际上有启动过程见书稿）
int main(void)
{

    uint32_t mMainLoopCount;  
    uint8_t  mFlag,cnt;            
    uint16_t light;

    DISABLE_INTERRUPTS;

    

    mMainLoopCount = 0;    
    mFlag='A';              
    

    gpio_init(LIGHT_BLUE,GPIO_OUTPUT,LIGHT_OFF);   
	adc_init(AD_LIGHT,0);
    
    //（1.6）使能模块中断
    //uart_enable_re_int(UART_User);
    //（1.7）【不变】开总中断
    ENABLE_INTERRUPTS;
    
    printf("-----------------------------------------------------\r\n"); 
    printf("金葫芦提示：振动马达测试实例 \r\n");
    printf("  ① 蓝灯闪烁\n");
    printf("  ② UART_Debug串口（波特率115200），输出振动马达提示信息 \r\n");
    printf("----------------------------------------------------\r\n"); 
    
    
    //（1）======启动部分（结尾）==========================================
    
    cnt=0;
    for(;;)     //for(;;)（开头）
    {
        
        mMainLoopCount++;                      
        if (mMainLoopCount<=6556677)  continue;  
        mMainLoopCount=0;
       // Test_Motor();
		light = adc_read(AD_LIGHT);
		light/=10;
		printf("%d\n",light);
		if(light<=1000){
			gpio_init(MOTOR,GPIO_OUTPUT,1);
		}
		else gpio_init(MOTOR,GPIO_OUTPUT,0);
    }   
}

//======以下为主函数调用的子函数存放处=====================================
//=====================================================================
//函数名称：Test_Motor
//函数返回：无
//参数说明：无
//功能概要：测试振动马达传感器函数
//=====================================================================
void Test_Motor()
{	
    static char OutputCtl=0;
    OutputCtl++;
    if (OutputCtl>=4) OutputCtl=1;
    switch (OutputCtl)
    {
    	case 1:
        	gpio_init(MOTOR,GPIO_OUTPUT,1);
            printf("振动马达开始振动\r\n\r\n");
            break;
        case 2:
            gpio_init(MOTOR,GPIO_OUTPUT,0);
            printf("振动马达停止振动\r\n\r\n");
            break;
        case 3:
            gpio_init(MOTOR,GPIO_OUTPUT,1);
            printf("振动马达再次振动\r\n\r\n");
            break;
        default:
	        break;
    }
   
}

void main_Dly_ms(uint32_t ms)
{
    for(uint32_t i= 0; i < (6000*ms); i++) __asm("nop");
}


//====================================================================
/*
知识要素：
（1）main.c是一个模板，该文件所有代码均不涉及具体的硬件和环境，通过调用构件
实现对硬件的干预。
（2）本文件中标有【不变】的地方为系统保留，此类代码与具体项目无关，不宜删除。
（3）本文件中对宏GLOBLE_VAR进行了定义，所以在包含"includes.h"头文件时，会定
义全局变量，在其他文件中包含"includes.h"头文件时，
编译时会自动增加extern
*/



